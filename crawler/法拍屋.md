ä»¥ä¸‹æ˜¯åœ¨åŸæœ‰åŠŸèƒ½åŸºç¤ä¸Šå¢åŠ ç™»å…¥èªè­‰æ©Ÿåˆ¶çš„å®Œæ•´å¯¦ä½œæ–¹æ¡ˆï¼Œä½¿ç”¨ **Streamlit-Authenticator** å¥—ä»¶å¯¦ç¾å®‰å…¨ç™»å…¥åŠŸèƒ½ï¼š

---

### **æ­¥é©Ÿ 1ï¼šå®‰è£å¿…è¦å¥—ä»¶**
```bash
pip install streamlit-authenticator pyyaml
```

---

### **æ­¥é©Ÿ 2ï¼šå»ºç«‹èªè­‰ç³»çµ±**
#### å»ºç«‹ `auth_config.yaml` è¨­å®šæª”
```yaml
credentials:
  usernames:
    admin:
      email: admin@example.com
      name: Admin
      password: 123456  # é¦–æ¬¡å•Ÿå‹•å¾Œéœ€é‡æ–°å“ˆå¸Œè™•ç†
    user1:
      email: user1@example.com
      name: User1
      password: abcdef
cookie:
  expiry_days: 1
  key: some_signature_key
  name: my_app_cookie
preauthorized:
  emails:
    - authorized_user@example.com
```

---

### **æ­¥é©Ÿ 3ï¼šæ•´åˆèªè­‰çš„å®Œæ•´ç¨‹å¼ç¢¼ (`app.py`)**
```python
import streamlit as st
import yaml
from yaml.loader import SafeLoader
import streamlit_authenticator as stauth
import pandas as pd
import plotly.express as px

# èªè­‰ç³»çµ±åˆå§‹åŒ–
with open('auth_config.yaml') as file:
    config = yaml.load(file, Loader=SafeLoader)

authenticator = stauth.Authenticate(
    config['credentials'],
    config['cookie']['name'],
    config['cookie']['key'],
    config['cookie']['expiry_days'],
    config['preauthorized']
)

# ç™»å…¥é é¢
name, authentication_status, username = authenticator.login('main')

# æ ¹æ“šç™»å…¥ç‹€æ…‹é¡¯ç¤ºå…§å®¹
if authentication_status:
    # ---------- ä¸»æ‡‰ç”¨ç¨‹å¼å…§å®¹ ----------
    authenticator.logout('ç™»å‡º', 'sidebar')
    st.sidebar.title(f"æ­¡è¿ï¼Œ{name}ï¼")
    
    # é é¢è¨­ç½®
    st.set_page_config(page_title="æ³•æ‹å±‹èˆ‡æ¨™æ¡ˆè¦–è¦ºåŒ–", layout="wide")
    st.title("ğŸ  æ³•æ‹å±‹èˆ‡æ”¿åºœæ¨™æ¡ˆæ•¸æ“šå„€è¡¨æ¿")

    # æ•¸æ“šåŠ è¼‰ï¼ˆç¤ºä¾‹æ•¸æ“šï¼Œéœ€æ›¿æ›å¯¦éš›çˆ¬èŸ²ä»£ç¢¼ï¼‰
    @st.cache_data
    def load_data():
        auctions = pd.DataFrame({
            'åœ°é»': ['å°åŒ—å¸‚', 'æ–°åŒ—å¸‚', 'å°ä¸­å¸‚'],
            'åƒ¹æ ¼': [2000, 1500, 1800],
            'lat': [25.04, 25.01, 24.15],
            'lon': [121.56, 121.46, 120.67]
        })
        procurements = pd.DataFrame({
            'æ©Ÿé—œ': ['è¡›ç”Ÿå±€', 'æ•™è‚²å±€', 'äº¤é€šå±€'],
            'é ç®—': [500, 800, 1200]
        })
        return auctions, procurements

    auctions, procurements = load_data()

    # å´é‚Šæ¬„éæ¿¾å™¨
    st.sidebar.header("ç¯©é¸æ¢ä»¶")
    selected_city = st.sidebar.selectbox("é¸æ“‡ç¸£å¸‚", options=auctions['åœ°é»'].unique())

    # æ³•æ‹å±‹åœ°åœ–
    st.header("æ³•æ‹å±‹åˆ†ä½ˆåœ°åœ–")
    st.map(auctions[['lat', 'lon']])

    # æ”¿åºœæ¨™æ¡ˆåˆ†æ
    st.header("æ”¿åºœæ¨™æ¡ˆé ç®—åˆ†æ")
    fig = px.bar(procurements, x='æ©Ÿé—œ', y='é ç®—')
    st.plotly_chart(fig)

    # é¡¯ç¤ºåŸå§‹æ•¸æ“šï¼ˆæ¬Šé™æ§åˆ¶ç¤ºä¾‹ï¼‰
    if username == 'admin':
        st.subheader("å®Œæ•´æ•¸æ“šï¼ˆç®¡ç†å“¡å°ˆå±¬ï¼‰")
        st.dataframe(auctions)
    else:
        st.warning("æ™®é€šç”¨æˆ¶æ¬Šé™ï¼Œåƒ…å¯æŸ¥çœ‹å½™ç¸½æ•¸æ“š")

elif authentication_status is False:
    st.error('å¸³è™Ÿ/å¯†ç¢¼ä¸æ­£ç¢º')
elif authentication_status is None:
    st.warning('è«‹è¼¸å…¥æ‚¨çš„å¸³è™Ÿå¯†ç¢¼')

# ---------- ç”¨æˆ¶ç®¡ç†ç•Œé¢ï¼ˆåƒ…adminå¯è¨ªå•ï¼‰ ----------
if authentication_status and username == 'admin':
    with st.expander("ğŸ” ç”¨æˆ¶ç®¡ç†"):
        try:
            if authenticator.register_user('è¨»å†Šæ–°ç”¨æˆ¶'):
                st.success('ç”¨æˆ¶è¨»å†ŠæˆåŠŸ')
                # æ›´æ–°è¨­å®šæª”
                with open('auth_config.yaml', 'w') as file:
                    yaml.dump(config, file, default_flow_style=False)
        except Exception as e:
            st.error(e)

        try:
            username_forgot, email_forgot = authenticator.forgot_password('å¿˜è¨˜å¯†ç¢¼')
            if username_forgot:
                st.success('å¯†ç¢¼é‡ç½®é€£çµå·²ç™¼é€è‡³è¨»å†Šéƒµç®±')
        except Exception as e:
            st.error(e)
```

---

### **æ­¥é©Ÿ 4ï¼šé¦–æ¬¡é‹è¡Œå¾Œå®‰å…¨åŒ–å¯†ç¢¼**
1. é¦–æ¬¡é‹è¡Œå¾Œåœæ­¢æ‡‰ç”¨
2. è‡ªå‹•ç”Ÿæˆçš„ `auth_config.yaml` æœƒé¡¯ç¤ºæ˜æ–‡å¯†ç¢¼
3. åŸ·è¡Œä»¥ä¸‹æŒ‡ä»¤ç”Ÿæˆå“ˆå¸Œå¯†ç¢¼ï¼š
```python
from auth_config import credentials
credentials['usernames']['admin']['password'] = stauth.Hasher(['123456']).generate()[0]
# æ›´æ–°yamlæ–‡ä»¶å¾Œé‡æ–°å•Ÿå‹•
```

---

### **å®‰å…¨å¼·åŒ–æªæ–½**
1. **HTTPSå‚³è¼¸**ï¼šéƒ¨ç½²æ™‚éœ€å•Ÿç”¨SSLæ†‘è­‰
2. **å¯†ç¢¼ç­–ç•¥**ï¼š
   ```python
   authenticator = Authenticate(
       ...
       validator=lambda x: len(x) >= 8  # å¯†ç¢¼é•·åº¦è¦æ±‚
   )
   ```
3. **æ—¥èªŒè¨˜éŒ„**ï¼šè¨˜éŒ„ç™»å…¥å˜—è©¦
4. **äºŒå› ç´ èªè­‰**ï¼šæ•´åˆGoogle Authenticator
   ```python
   authenticator.totp = True  # å•Ÿç”¨TOTP
   ```

---

### **é€²éšæ¬Šé™ç³»çµ±ç¯„ä¾‹**
```python
# åœ¨yamlå¢åŠ æ¬Šé™å±¤ç´š
credentials:
  usernames:
    admin:
      ...
      permissions: ['admin', 'view']
    user1:
      ...
      permissions: ['view']

# æ¬Šé™æª¢æŸ¥å‡½æ•¸
def check_permission(required_level):
    user_perms = config['credentials']['usernames'][username]['permissions']
    return required_level in user_perms

# ä½¿ç”¨ç¯„ä¾‹
if check_permission('admin'):
    st.button("ç®¡ç†å“¡å°ˆç”¨åŠŸèƒ½")
```

---

### **åŸ·è¡ŒæŒ‡ä»¤**
```bash
streamlit run app.py
```

---

æ­¤æ–¹æ¡ˆæä¾›ä»¥ä¸‹é—œéµåŠŸèƒ½ï¼š
1. å¤šå±¤ç´šç”¨æˆ¶æ¬Šé™ç³»çµ±
2. å®‰å…¨å¯†ç¢¼å“ˆå¸Œå„²å­˜
3. ç”¨æˆ¶è‡ªåŠ©æœå‹™ï¼ˆè¨»å†Š/å¯†ç¢¼é‡ç½®ï¼‰
4. åŸºæ–¼Cookieçš„æœƒè©±ç®¡ç†
5. æ¬Šé™æ•æ„Ÿçš„UIæ§åˆ¶

å¯¦éš›éƒ¨ç½²æ™‚éœ€ï¼š
1. å®šæœŸå‚™ä»½ `auth_config.yaml`
2. é™åˆ¶ç®¡ç†å“¡è¨»å†ŠåŠŸèƒ½
3. ç›£æ§ç•°å¸¸ç™»å…¥å˜—è©¦
4. å®šæœŸæ›´æ–°ä¾è³´å¥—ä»¶